import{Prev}from"./Prev.js";var to="to",m="m",p_d_if="p-d-if",PDIf="PDIf";export var PD=function(_Prev){babelHelpers.inherits(PD,_Prev);function PD(){babelHelpers.classCallCheck(this,PD);return babelHelpers.possibleConstructorReturn(this,(PD.__proto__||Object.getPrototypeOf(PD)).apply(this,arguments))}babelHelpers.createClass(PD,[{key:"getPreviousSib",value:function getPreviousSib(){var prevSibling=this;while(prevSibling&&"P-D"===prevSibling.tagName){prevSibling=prevSibling.previousElementSibling}return prevSibling}},{key:"detach",value:function detach(prevSibling){prevSibling.removeEventListener(this._on,this._boundHandleEvent)}},{key:"_handleEvent",value:function _handleEvent(e){if(e.stopPropagation)e.stopPropagation();this._lastEvent=e;if(!this._cssPropMap){return}this.passDown(this.nextElementSibling,e)}},{key:"passDown",value:function passDown(start,e){var _this=this,nextSibling=start,count=0;while(nextSibling){this._cssPropMap.forEach(function(map){if("*"===map.cssSelector||nextSibling.matches(map.cssSelector)){count++;if(!map.propSource){var defaultProp=_this.getPropFromPath(e,"detail.value");if(!defaultProp)defaultProp=_this.getPropFromPath(e,"target.value");nextSibling[map.propTarget]=defaultProp}nextSibling[map.propTarget]=_this.getPropFromPath(e,map.propSource)}if(_this.id&&nextSibling.hasAttribute(p_d_if)){if(!nextSibling[PDIf])nextSibling[PDIf]=JSON.parse(nextSibling.getAttribute(p_d_if));if(nextSibling[PDIf].contains(_this.id)){_this.passDown(nextSibling,e)}}});if(this._hasMax&&count>=this._m)break;nextSibling=nextSibling.nextElementSibling}}},{key:"getPropFromPath",value:function getPropFromPath(val,path){if(!path)return val;var context=val;path.split(".").forEach(function(token){if(context)context=context[token]});return context}},{key:"attributeChangedCallback",value:function attributeChangedCallback(name,oldVal,newVal){switch(name){case to:if(newVal.endsWith("}"))newVal+=";";this._to=newVal;this.parseTo();if(this._lastEvent)this._handleEvent(this._lastEvent);break;case m:if(null!==newVal){this._m=parseInt(newVal);this._hasMax=!0}else{this._hasMax=!1}}babelHelpers.get(PD.prototype.__proto__||Object.getPrototypeOf(PD.prototype),"attributeChangedCallback",this).call(this,name,oldVal,newVal);this.onPropsChange()}},{key:"connectedCallback",value:function connectedCallback(){this._upgradeProperties([to,m]);this._connected=!0;this.onPropsChange()}},{key:"disconnectedCallback",value:function disconnectedCallback(){var prevSibling=this.getPreviousSib();if(prevSibling&&this._boundHandleEvent)this.detach(prevSibling);this.disconnectSiblingObserver()}},{key:"onPropsChange",value:function onPropsChange(){if(!this._connected||!this._on||!this._to)return;this.attachEventListeners()}},{key:"addMutationObserver",value:function addMutationObserver(){var _this2=this;if(!this.parentElemen)return;this._siblingObserver=new MutationObserver(function(){if(!_this2._lastEvent)return;_this2._handleEvent(_this2._lastEvent)});this._siblingObserver.observe(this.parentElement,{childList:!0})}},{key:"disconnectSiblingObserver",value:function disconnectSiblingObserver(){if(this._siblingObserver)this._siblingObserver.disconnect()}},{key:"parseTo",value:function parseTo(){var _this3=this;if(this._cssPropMap&&this._to===this._lastTo)return;this._lastTo=this._to;this._cssPropMap=[];var splitPassDown=this._to.split("};");splitPassDown.forEach(function(passDownSelectorAndProp){if(!passDownSelectorAndProp)return;var mapTokens=passDownSelectorAndProp.split("{"),splitPropPointer=mapTokens[1].split(":"),cssSelector=mapTokens[0];if(!cssSelector){cssSelector="*";_this3._m=1;_this3._hasMax=!0}_this3._cssPropMap.push({cssSelector:cssSelector,propTarget:splitPropPointer[0],propSource:0<splitPropPointer.length?splitPropPointer[1]:null})});if(!this._addedSiblingMutationObserver){this.addMutationObserver()}}},{key:"to",get:function get(){return this._to},set:function set(val){this.setAttribute(to,val)}},{key:"m",get:function get(){return this._m},set:function set(val){this.setAttribute(val.toString())}}],[{key:"is",get:function get(){return"p-d"}},{key:"observedAttributes",get:function get(){return babelHelpers.get(PD.__proto__||Object.getPrototypeOf(PD),"observedAttributes",this).concat([to,m])}}]);return PD}(Prev);if(!customElements.get(PD.is)){customElements.define(PD.is,PD)}