import{XtallatX}from"xtal-element/xtal-latx.js";import{hydrate}from"trans-render/hydrate.js";const on="on",noblock="noblock",iff="if",to="to",prop="prop",val="val";export class P extends(XtallatX(hydrate(HTMLElement))){constructor(){super(),this._s=null,this._lastEvent=null}get on(){return this._on}set on(t){this.attr(on,t)}get to(){return this._to}set to(t){this.attr(to,t)}get noblock(){return this._noblock}set noblock(t){this.attr(noblock,t,"")}get if(){return this._if}set if(t){this.attr(iff,t)}get prop(){return this._prop}set prop(t){switch(typeof t){case"symbol":this._prop=t;break;default:this.attr(prop,t)}}get val(){return this._val}set val(t){this.attr(prop,t)}static get observedAttributes(){return super.observedAttributes.concat([on,to,noblock,iff,prop,val])}getSplit(t){return"."===t?[]:t.split(".")}attributeChangedCallback(t,s,e){const i="_"+t;switch(t){case iff:case on:case prop:case val:case to:this[i]=e;break;case noblock:this[i]=null!==e}t===val&&null!==e&&(this._s=this.getSplit(e)),super.attributeChangedCallback(t,s,e)}getPreviousSib(){let t=this;for(;t&&t.tagName.startsWith("P-");)t=t.previousElementSibling;return null===t&&(t=this.parentElement),t}connectedCallback(){this.style.display="none",this.propUp([on,to,noblock,iff,prop,val]),this.init()}init(){this.attchEvListnrs(),this.doFake()}attchEvListnrs(){if(this._bndHndlEv)return;this._bndHndlEv=this._hndEv.bind(this);const t=this.getPreviousSib();if(!t)return;t.addEventListener(this._on,this._bndHndlEv);const s=t.getAttribute("disabled");null!==s&&(0===s.length||"1"===s?t.removeAttribute("disabled"):t.setAttribute("disabled",(parseInt(s)-1).toString()))}skI(){return this.hasAttribute("skip-init")}doFake(){if(!this._if&&!this.skI()){let t=this._lastEvent;t||(t={target:this.getPreviousSib(),isFake:!0}),this._hndEv&&this._hndEv(t)}}_hndEv(t){this.hasAttribute("debug"),t&&(t.stopPropagation&&!this._noblock&&t.stopPropagation(),this._if&&!t.target.matches(this._if)||(this._lastEvent=t,this.pass(t)))}$N(t,s){return null==t?s:t}propFromEvent(t){const s=this.getProp.bind(this);return null!==this._s?s(t,this._s):this.$N(s(t,["detail","value"]),s(t,["target","value"]))}setVal(t,s){this.commit(s,this.propFromEvent(t))}commit(t,s){void 0!==s&&(t[this.prop]=s)}getProp(t,s){let e=t;return s.forEach(t=>{if(e)switch(typeof t){case"string":e=e[t];break;default:e=e[t[0]].apply(e,t[1])}}),e}detach(t){t.removeEventListener(this._on,this._bndHndlEv)}disconnectedCallback(){const t=this.getPreviousSib();t&&this._bndHndlEv&&this.detach(t)}}